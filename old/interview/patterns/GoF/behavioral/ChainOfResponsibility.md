## `Chain of responsibility (Цепочка обязанностей)`

Цепочка обязанностей — это поведенческий паттерн проектирования, который позволяет передавать запросы последовательно 
по цепочке обработчиков. Каждый последующий обработчик решает, может ли он обработать запрос сам и стоит ли передавать 
запрос дальше по цепи.

### `Проблема`

Представьте, что вы делаете систему приёма онлайн-заказов. Вы хотите ограничить к ней доступ так, чтобы только 
авторизованные пользователи могли создавать заказы. Кроме того, определённые пользователи, владеющие правами 
администратора, должны иметь полный доступ к заказам.

Вы быстро сообразили, что эти проверки нужно выполнять последовательно. Ведь пользователя можно попытаться 
«залогинить» в систему, если его запрос содержит логин и пароль. Но если такая попытка не удалась, 
то проверять расширенные права доступа попросту не имеет смысла.

Затем мы решили сделать еще несколько проверок
- неплохо бы проверять данные, передаваемые в запросе перед тем, как вносить их в систему — 
вдруг запрос содержит данные о покупке несуществующих продуктов.
- блокировать массовые отправки формы с одним и тем же логином, чтобы предотвратить подбор паролей ботами.
- форму заказа неплохо бы доставать из кеша, если она уже была однажды показана.

С каждой новой «фичей» код проверок, выглядящий как большой клубок условных операторов, всё больше и больше раздувался. 
При изменении одного правила приходилось трогать код всех проверок. 
А для того, чтобы применить проверки к другим ресурсам, пришлось продублировать их код в других классах.

### `Решение`

Цепочка обязанностей базируется на том, чтобы превратить отдельные поведения в объекты.
Данные запроса, над которым происходит проверка, будут передаваться в метод как аргументы.

Паттерн предлагает `связать объекты обработчиков в одну цепь`. Каждый из них будет иметь ссылку на следующий обработчик 
в цепи. Таким образом, при получении запроса обработчик сможет не только сам что-то с ним сделать, 
но и передать обработку следующему объекту в цепочке.

Обработчик не обязательно должен передавать запрос дальше, причём эта особенность может быть использована по-разному.
В примере с фильтрацией доступа обработчики прерывают дальнейшие проверки, если текущая проверка не прошла. 
Ведь нет смысла тратить попусту ресурсы, если и так понятно, что с запросом что-то не так.

![Alt text](https://refactoring.guru/images/patterns/diagrams/chain-of-responsibility/solution1-ru-2x.png)

`Но есть и другой подход`, при котором обработчики прерывают цепь только когда они могут обработать запрос. 
В этом случае запрос движется по цепи, пока не найдётся обработчик, который может его обработать. 
Очень часто такой подход используется для передачи событий, создаваемых классами графического интерфейса в 
результате взаимодействия с пользователем.

Например, когда пользователь кликает по кнопке, программа выстраивает цепочку из объекта этой кнопки, 
всех её родительских элементов и общего окна приложения на конце. Событие клика передаётся по этой цепи до тех пор, 
пока не найдётся объект, способный его обработать. Этот пример примечателен ещё и тем, что цепочку всегда можно выделить 
из древовидной структуры объектов, в которую обычно и свёрнуты элементы пользовательского интерфейса.

![Alt text](https://refactoring.guru/images/patterns/diagrams/chain-of-responsibility/solution2-ru-2x.png)

### `Структура`

![Alt text](https://refactoring.guru/images/patterns/diagrams/chain-of-responsibility/example-ru-2x.png)

### `Применимость`

- Когда программа должна обрабатывать разнообразные запросы несколькими способами, но заранее неизвестно, 
какие конкретно запросы будут приходить и какие обработчики для них понадобятся.
- Когда важно, чтобы обработчики выполнялись один за другим в строгом порядке.
- Когда набор объектов, способных обработать запрос, должен задаваться динамически.

### `Источники`

- [Подробнее о паттерне на refactoring.guru](https://refactoring.guru/ru/design-patterns/chain-of-responsibility)

- [Реализация на Java](https://refactoring.guru/ru/design-patterns/chain-of-responsibility/java/example)